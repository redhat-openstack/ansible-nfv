---
# Setting a retry amount in order to ensure that extra_specs are applied.
- name: "Flavors {{ resource_state }}"
  vars:
    ansible_python_interpreter: "{{ venv_path }}/bin/python"
  openstack.cloud.compute_flavor:
    cloud: "{{ item.cloud_name | default(cloud_name) }}"
    name: "{{ item.name }}"
    ram: "{{ item.ram }}"
    disk: "{{ item.disk }}"
    vcpus: "{{ item.vcpus }}"
    extra_specs: "{{ item.extra_specs | default({}) }}"
    validate_certs: "{{ validate_certs | default(omit) }}"
    state: "{{ resource_state }}"
    flavorid: "{{ item.flavorid | default (omit) }}"
  loop: "{{ flavors }}"
  retries: 10
  until: item['extra_specs'] == os_flavor.flavor['extra_specs']
  register: os_flavor
