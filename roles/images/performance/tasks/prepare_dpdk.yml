#- name: Update packages to latest
#  virt_customize_command:
#    shell:
#      - "sudo yum update -y"
#    image: "{{ fetched_image }}"
#    selinux_relabel: True

- name: Install packages inside guest image
  virt_customize_package:
    name:
      - git
      - gcc
      - make
      - cmake
      - gcc-c++
      - pciutils
      - glibc-devel
      - glibc-headers
      - numactl-devel
      - vim
      - tmux
      - python3-pip
      - elfutils-libelf-devel
      - kernel-devel
      - kernel-headers
    state: present
    image: "{{ fetched_image }}"
    selinux_relabel: True

# Compile DPDK without: rt-kni, igbuio
#- name: Prepare DPDK binaries inside guest image
#  virt_customize_command:
#    shell:
#      - "sudo alternatives --remove-all python;sudo alternatives --install /usr/bin/python python /usr/bin/python3.6 2"
#      - "sudo pip3 install meson pyelftools ninja"
#      - "cd /root; curl  http://file.mad.redhat.com/~mnietoji/iavf-4.1.1.tar.gz | tar -xz; cd /root/iavf-4.1.1/src; make install"
#      - "if [ ! -d {{ dpdk_dir }} ];then git clone {{ dpdk_git }} {{ dpdk_dir }};cd {{ dpdk_dir }};git checkout {{ dpdk_branch }};fi"
#      - "if [ ! -d {{ trafficgen_dir }} ];then git clone {{ trafficgen_git }} {{ trafficgen_dir }};cd {{ trafficgen_dir }};git checkout {{ trafficgen_branch }};fi"
#      - "sed -i 's/enforcing/{{ selinux_config }}/g' /etc/selinux/config /etc/selinux/config"
#      - "export PATH=$PATH:/usr/local/bin;cd {{ dpdk_dir }}; meson -Dexamples=all build;ninja -C build"
#    image: "{{ fetched_image }}"
#    selinux_relabel: True
